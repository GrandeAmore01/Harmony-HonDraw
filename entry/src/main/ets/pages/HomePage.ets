import { router } from '@kit.ArkUI'
import { picker } from '@kit.CoreFileKit'

// ä¸»é¡µ - å›¾ç‰‡åº“
@Entry
@Component
struct HomePage {
  @State recentImages: string[] = []
  @State showTips: boolean = true

  // é€‰æ‹©å›¾ç‰‡
  async selectImage() {
    try {
      const photoSelectOptions = new picker.PhotoSelectOptions()
      photoSelectOptions.MIMEType = picker.PhotoViewMIMETypes.IMAGE_TYPE
      photoSelectOptions.maxSelectNumber = 1

      const photoPicker = new picker.PhotoViewPicker()
      const result = await photoPicker.select(photoSelectOptions)

      if (result && result.photoUris && result.photoUris.length > 0) {
        const imageUri = result.photoUris[0]
        // è·³è½¬åˆ°ç¼–è¾‘å™¨é¡µé¢
        router.pushUrl({
          url: 'pages/EditorPage',
          params: {
            imageUri: imageUri,
            isCollaborative: false
          }
        })
      }
    } catch (err) {
      console.error('é€‰æ‹©å›¾ç‰‡å¤±è´¥:', JSON.stringify(err))
    }
  }

  // å¼€å¯ååŒç¼–è¾‘
  startCollaboration() {
    router.pushUrl({
      url: 'pages/CollaborationPage'
    })
  }

  build() {
    Column() {
      // é¡¶éƒ¨æ ‡é¢˜æ 
      Row() {
        Text('é¸¿ç»˜')
          .fontSize(28)
          .fontWeight(FontWeight.Bold)
          .fontColor('#1A1A1A')

        Blank()

        Button('ååŒç¼–è¾‘')
          .fontSize(14)
          .backgroundColor('#007DFF')
          .borderRadius(20)
          .height(40)
          .onClick(() => {
            this.startCollaboration()
          })
      }
      .width('100%')
      .height(60)
      .padding({ left: 20, right: 20 })
      .backgroundColor('#FFFFFF')

      Scroll() {
        Column({ space: 20 }) {
          // æ¬¢è¿å¡ç‰‡
          Column({ space: 16 }) {
            Text('æ¬¢è¿ä½¿ç”¨é¸¿ç»˜å›¾ç‰‡ç¼–è¾‘å™¨')
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .fontColor('#FFFFFF')

            Text('ä¸“ä¸šçš„å›¾ç‰‡ç¼–è¾‘å·¥å…·ï¼Œæ”¯æŒå¤šäººååŒåˆ›ä½œ')
              .fontSize(14)
              .fontColor('#FFFFFF')
              .opacity(0.9)

            Button('å¼€å§‹ç¼–è¾‘')
              .fontSize(16)
              .fontWeight(FontWeight.Medium)
              .backgroundColor('#FFFFFF')
              .fontColor('#007DFF')
              .borderRadius(24)
              .height(48)
              .width(160)
              .onClick(() => {
                this.selectImage()
              })
          }
          .width('100%')
          .padding(24)
          .borderRadius(16)
          .linearGradient({
            angle: 135,
            colors: [[0x007DFF, 0.0], [0x0A59F7, 1.0]]
          })

          // åŠŸèƒ½å¡ç‰‡
          Column({ space: 12 }) {
            Text('ä¸»è¦åŠŸèƒ½')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor('#1A1A1A')
              .alignSelf(ItemAlign.Start)

            Grid() {
              GridItem() {
                this.FeatureCard('âœï¸', 'ç»˜å›¾', 'è‡ªç”±ç»˜åˆ¶çº¿æ¡å’Œå½¢çŠ¶')
              }
              GridItem() {
                this.FeatureCard('âœ‚ï¸', 'è£å‰ª', 'è£å‰ªå’Œè°ƒæ•´å›¾ç‰‡')
              }
              GridItem() {
                this.FeatureCard('â˜€ï¸', 'è°ƒèŠ‚', 'äº®åº¦å’Œå¯¹æ¯”åº¦')
              }
              GridItem() {
                this.FeatureCard('ğŸ·ï¸', 'æ°´å°', 'æ·»åŠ æ–‡å­—æ°´å°')
              }
              GridItem() {
                this.FeatureCard('â†»', 'æ—‹è½¬', 'æ—‹è½¬å’Œç¿»è½¬')
              }
              GridItem() {
                this.FeatureCard('ğŸ‘¥', 'ååŒ', 'å¤šäººå®æ—¶ç¼–è¾‘')
              }
            }
            .columnsTemplate('1fr 1fr 1fr')
            .rowsGap(12)
            .columnsGap(12)
            .width('100%')
          }
          .width('100%')

          // æœ€è¿‘ç¼–è¾‘
          if (this.recentImages.length > 0) {
            Column({ space: 12 }) {
              Text('æœ€è¿‘ç¼–è¾‘')
                .fontSize(18)
                .fontWeight(FontWeight.Bold)
                .fontColor('#1A1A1A')
                .alignSelf(ItemAlign.Start)

              List({ space: 12 }) {
                ForEach(this.recentImages, (image: string, index: number) => {
                  ListItem() {
                    Row({ space: 12 }) {
                      Image(image)
                        .width(80)
                        .height(80)
                        .borderRadius(8)
                        .objectFit(ImageFit.Cover)

                      Column({ space: 4 }) {
                        Text(`å›¾ç‰‡ ${index + 1}`)
                          .fontSize(16)
                          .fontWeight(FontWeight.Medium)
                          .fontColor('#1A1A1A')

                        Text('æœ€è¿‘ç¼–è¾‘')
                          .fontSize(12)
                          .fontColor('#999999')
                      }
                      .alignItems(HorizontalAlign.Start)

                      Blank()

                      Button('ç»§ç»­ç¼–è¾‘')
                        .fontSize(14)
                        .height(32)
                        .backgroundColor('#007DFF')
                    }
                    .width('100%')
                    .padding(12)
                    .backgroundColor('#FFFFFF')
                    .borderRadius(12)
                    .shadow({
                      radius: 8,
                      color: '#10000000',
                      offsetY: 2
                    })
                  }
                })
              }
              .width('100%')
            }
            .width('100%')
          }

          // ä½¿ç”¨æç¤º
          if (this.showTips) {
            Column({ space: 12 }) {
              Row() {
                Text('ğŸ’¡ ä½¿ç”¨æç¤º')
                  .fontSize(16)
                  .fontWeight(FontWeight.Medium)
                  .fontColor('#1A1A1A')

                Blank()

                Text('Ã—')
                  .fontSize(20)
                  .fontColor('#999999')
                  .onClick(() => {
                    this.showTips = false
                  })
              }
              .width('100%')

              Text('â€¢ ç‚¹å‡»"å¼€å§‹ç¼–è¾‘"é€‰æ‹©å›¾ç‰‡å¼€å§‹åˆ›ä½œ\nâ€¢ ä½¿ç”¨"ååŒç¼–è¾‘"é‚€è¯·ä»–äººä¸€èµ·ç¼–è¾‘\nâ€¢ æ”¯æŒæ’¤é”€/é‡åšåŠŸèƒ½\nâ€¢ ç¼–è¾‘å®Œæˆåå¯ä¸€é”®åˆ†äº«')
                .fontSize(14)
                .fontColor('#666666')
                .lineHeight(22)
            }
            .width('100%')
            .padding(16)
            .backgroundColor('#FFF9E6')
            .borderRadius(12)
            .border({ width: 1, color: '#FFE58F' })
          }
        }
        .padding(20)
      }
      .layoutWeight(1)
      .backgroundColor('#F5F5F5')
    }
    .width('100%')
    .height('100%')
  }

  // åŠŸèƒ½å¡ç‰‡ç»„ä»¶
  @Builder
  FeatureCard(icon: string, title: string, desc: string) {
    Column({ space: 8 }) {
      Text(icon)
        .fontSize(32)

      Text(title)
        .fontSize(14)
        .fontWeight(FontWeight.Medium)
        .fontColor('#1A1A1A')

      Text(desc)
        .fontSize(10)
        .fontColor('#999999')
        .textAlign(TextAlign.Center)
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
    }
    .width('100%')
    .height(120)
    .padding(12)
    .backgroundColor('#FFFFFF')
    .borderRadius(12)
    .justifyContent(FlexAlign.Center)
    .shadow({
      radius: 8,
      color: '#10000000',
      offsetY: 2
    })
  }
}

